bindkey -e

HISTFILE=~/.histfile
HISTSIZE=10000
SAVEHIST=100000

# Remove '/' from wordchars.
WORDCHARS="${WORDCHARS/\//}"

setopt autocd beep extendedglob nomatch notify

autoload -Uz compinit
compinit

venv() {
  env=$1
  if [ -z $env ]; then
    return 1
  fi
  env_dir=~/.venv/$env
  if [ ! -d $env_dir ]; then
    python -m venv $env_dir
  fi
  source $env_dir/bin/activate
}

if [ -n "${commands[zoxide]}" ]; then
  eval "$(zoxide init zsh)"
fi

function history-fzy() {
  local tac

  if which tac > /dev/null; then
    tac="tac"
  else
    tac="tail -r"
  fi

  BUFFER=$(history -n 1 | eval $tac | awk '!a[$0]++' | fzy --query "$LBUFFER")
  CURSOR=$#BUFFER

  zle reset-prompt
}

zle -N history-fzy
bindkey '^r' history-fzy
